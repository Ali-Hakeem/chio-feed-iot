<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Dashboard IoT</title>
  </head>
  <body>
    <h1>Dashboard IoT</h1>
    <button id="rotateBtn">Putar Servo</button>
    <button id="logoutBtn">Logout</button>
    <p id="statusText"></p>

    <script>
      // === AUTH GUARD ===
      // Jika user belum login, redirect ke halaman login
      const user = localStorage.getItem("username");
      if (!user) {
        alert("🚫 Anda belum login!");
        window.location.href = "/";
      }

      // === FUNGSI TOMBOL PUTAR ===
      document.getElementById("rotateBtn").addEventListener("click", async () => {
        try {
          const res = await fetch("/api/rotate", { method: "POST" });
          const data = await res.json();

          if (data.success) {
            document.getElementById("statusText").innerText = "Servo berputar...";
            setTimeout(() => {
              document.getElementById("statusText").innerText = "Servo berhenti.";
            }, 3000);
          } else {
            alert("Gagal memutar servo!");
          }
        } catch (err) {
          alert("⚠️ Tidak bisa menghubungi server.");
        }
      });

      // === FUNGSI LOGOUT ===
      document.getElementById("logoutBtn").addEventListener("click", async () => {
        try {
          await fetch("/api/logout");
        } catch (e) {}
        // hapus data login
        localStorage.removeItem("username");
        window.location.href = "/";
      });
    </script>
  </body>
</html>
